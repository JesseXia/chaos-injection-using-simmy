@model GeneralChaosSettingViewModel

@{
    ViewData["Title"] = "Chaos Settings";
}

<h2>Chaos Settings</h2>
<div asp-validation-summary="All" class="text-danger"></div>

<form method="post">
    <div class="panel panel-default">
        <div class="panel-heading">General Chaos Settings</div>
        <div class="panel-body">

            <div class="form-row">
                <div class="form-group col-md-4">
                    <input asp-for="AutomaticChaosInjectionEnabled" type="checkbox" class="automatic-chaos-injection" />
                    <label asp-for="AutomaticChaosInjectionEnabled">Enable Automatic Chaos Injection</label>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="Frequency"></label>
                    <input asp-for="Frequency" type="time" class="form-control frecuency" value="@Model.Frequency" min="00:15" />
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="MaxDuration">Max Duration</label>
                    <input asp-for="MaxDuration" type="time" class="form-control max-duration" value="@Model.MaxDuration" min="00:05" max="01:00" />
                </div>
            </div>

            <div class="form-group col-md-12">
                <hr />
            </div>

            <div class="form-row">
                <div class="form-group col-md-4">
                    <input asp-for="ClusterChaosEnabled" type="checkbox" class="cluster-chaos" />
                    <label asp-for="ClusterChaosEnabled">Enable Cluster Chaos</label>
                </div>
                <div class="form-group col-md-4">
                    <label asp-for="PercentageNodesToRestart">Percentage Nodes To Restart</label>
                    <input asp-for="PercentageNodesToRestart" type="number" class="form-control nodes-to-restart" value="@Model.PercentageNodesToRestart" min="0" max="100" />
                </div>
                <div class="col-md-4">
                    <label asp-for="PercentageNodesToStop">Percentage Nodes To Stop</label>
                    <input asp-for="PercentageNodesToStop" type="number" class="form-control nodes-to-stop" value="@Model.PercentageNodesToStop" min="0" max="100" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-12">
                    <button asp-controller="Chaos" asp-action="UpdateGeneralSettings" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    @{
        if(Model.Id != default)
        {
            await Html.RenderPartialAsync("_OperationSettingsList", Model?.OperationChaosSettings);
        }
    }
</form>

@* Once again, sorry for this UGLY js *@
@section Scripts {
    <script>
        window.onload = function () {
            $(".automatic-chaos-injection").change(automaticChaosInjectionChanged);
            $(".cluster-chaos").change(clusterChaosChanged);
            $(".automatic-chaos-injection").trigger("change");
            $(".cluster-chaos").trigger("change");
        };

        let automaticChaosInjectionChanged = (event) => {
            var enable = true;
            if (event.currentTarget.checked == false) {
                enable = false;
            }

            $(".frecuency").prop("readonly", !enable);
            $(".max-duration").prop("readonly", !enable);
        };

        let clusterChaosChanged = (event) => {
            var enable = true;
            if (event.currentTarget.checked == false) {
                enable = false;
            }

            $(".nodes-to-restart").prop("readonly", !enable);
            $(".nodes-to-stop").prop("readonly", !enable);
        };
    </script>
}